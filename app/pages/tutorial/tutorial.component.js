"use strict";
var core_1 = require("@angular/core");
var label_1 = require("ui/label");
var stack_layout_1 = require("ui/layouts/stack-layout");
var page_1 = require("ui/page");
var detection_component_1 = require("../../shared/detection.component");
var tutorial_services_1 = require("./tutorial.services");
var nativescript_audio_1 = require("nativescript-audio");
var nativescript_angular_1 = require("nativescript-angular");
var enums_1 = require("ui/enums");
var absolute_layout_1 = require("ui/layouts/absolute-layout");
var platform_1 = require("platform");
var TutorialComponent = (function () {
    function TutorialComponent(routerExtensions, tutorialService, zone, page) {
        this.routerExtensions = routerExtensions;
        this.tutorialService = tutorialService;
        this.zone = zone;
        this.page = page;
        this.currentState = TutorialState.INTRO;
        this.gestureCount = 1;
        // score variables
        this.score = 0;
        this.scoreMultiplier = 1;
    }
    TutorialComponent.prototype.ngOnDestroy = function () {
        this.player.pause();
        this.gestureDetection.destroy();
    };
    TutorialComponent.prototype.getNgZone = function () {
        return this.zone;
    };
    TutorialComponent.prototype.ngOnInit = function () {
        this.gestureDetection = new detection_component_1.QuickGestureDetection(this);
        this.tutorialLayout = this.page.getViewById("tutorialLayout");
        this.updateState();
    };
    TutorialComponent.prototype.createGestureDetectedLabel = function (text, correctDetection, duration, minimumOpacity, expand) {
        if (correctDetection === void 0) { correctDetection = true; }
        if (duration === void 0) { duration = 2500; }
        if (minimumOpacity === void 0) { minimumOpacity = 0; }
        if (expand === void 0) { expand = 0; }
        var minimum = Math.min(platform_1.screen.mainScreen.widthDIPs, platform_1.screen.mainScreen.heightDIPs);
        var label = new label_1.Label();
        label.textWrap = true;
        label.cssClass = correctDetection ? "correct-detection" : "false-detection";
        label.text = text;
        label.style.width = minimum / 2 * (1 + expand);
        label.style.height = minimum / 2 * (1 + expand);
        label.style.borderRadius = minimum / 4 * (1 + expand);
        label.style.fontSize = 35 * (1 + expand / 2);
        absolute_layout_1.AbsoluteLayout.setLeft(label, platform_1.screen.mainScreen.widthDIPs / 2 - (label.style.width / 2));
        absolute_layout_1.AbsoluteLayout.setTop(label, platform_1.screen.mainScreen.heightDIPs / 2 - (label.style.height / 2));
        this.tutorialLayout.addChild(label);
        var animation = label.createAnimation({
            opacity: minimumOpacity,
            duration: duration,
            curve: enums_1.AnimationCurve.easeIn
        });
        return animation.play();
    };
    TutorialComponent.prototype.createAbsoluteLabel = function (text, left, top) {
        var label = new label_1.Label();
        label.textWrap = true;
        label.style.fontSize = 24;
        label.style.textAlignment = 'left';
        label.text = text;
        label.style.zIndex = 1000;
        absolute_layout_1.AbsoluteLayout.setLeft(label, left);
        absolute_layout_1.AbsoluteLayout.setTop(label, top);
        this.tutorialLayout.addChild(label);
        return label;
    };
    TutorialComponent.prototype.createLabel = function (layout, text, delay) {
        if (delay === void 0) { delay = 0; }
        var label = new label_1.Label();
        label.textWrap = true;
        label.style.opacity = 0;
        label.style.fontSize = 24;
        label.style.textAlignment = "left";
        label.text = text;
        label.style.margin = "10";
        label.style.width = platform_1.screen.mainScreen.widthDIPs - 10;
        if (delay != 0) {
            label.style.fontWeight = "bold";
            label.style.fontSize = 32;
        }
        layout.addChild(label);
        var animation = label.createAnimation({
            opacity: 1,
            duration: 750,
            delay: delay
        });
        return animation.play();
    };
    TutorialComponent.prototype.quickGestureDetected = function () {
        var _this = this;
        switch (this.currentState) {
            case TutorialState.MOVEMENT_SINGLE:
                this.tutorialLayout.removeChildren();
                this.createGestureDetectedLabel("Movement detected!", true, 1500, 1, 0.5)
                    .then(function () {
                    _this.nextState();
                });
                break;
            case TutorialState.MOVEMENT_LEARNING_START:
                this.tutorialLayout.removeChildren();
                this.gestureCount++;
                this.createGestureDetectedLabel(this.gestureCount + " / 10", true, 2500, 0, 0);
                if (this.gestureCount == 10) {
                    this.nextState();
                }
                break;
            case TutorialState.MUSIC:
                this.nextState();
                this.quickGestureDetected();
                break;
            case TutorialState.MUSIC_STARTED:
                var actualBeatExists = false;
                var timeSinceStartInSeconds = (new Date().getTime() - this.startTime) / 1000;
                var beats = this.selectedSong['beats'].split(",").map(function (value) {
                    return +value;
                });
                for (var _i = 0, beats_1 = beats; _i < beats_1.length; _i++) {
                    var beat = beats_1[_i];
                    // beat at current time detected
                    var diff = Math.abs(beat - timeSinceStartInSeconds);
                    if (diff < 0.25) {
                        actualBeatExists = true;
                        break;
                    }
                }
                if (actualBeatExists) {
                    this.score += this.scoreMultiplier;
                    this.scoreMultiplier++;
                }
                else {
                    this.scoreMultiplier = 0;
                }
                this.createGestureDetectedLabel(actualBeatExists ? "+" + this.scoreMultiplier : "Missed!", actualBeatExists, 2500, 0, this.scoreMultiplier / 10);
                break;
        }
    };
    TutorialComponent.prototype.updateState = function () {
        var _this = this;
        switch (this.currentState) {
            case TutorialState.INTRO:
                var stackLayout = new stack_layout_1.StackLayout();
                this.tutorialLayout.addChild(stackLayout);
                this.createLabel(stackLayout, "Want to dance with your crush?", 0)
                    .then(function () {
                    return _this.createLabel(stackLayout, "Want to experience and listen to music in a completely new way?", 0);
                })
                    .then(function () {
                    return _this.createLabel(stackLayout, "Want to learn an instrument?", 0);
                })
                    .then(function () {
                    return _this.createLabel(stackLayout, "You need to learn rhythm first!", 1000);
                });
                break;
            case TutorialState.MOVEMENT_SINGLE:
                this.tutorialLayout.removeChildren();
                var stackLayout = new stack_layout_1.StackLayout();
                this.tutorialLayout.addChild(stackLayout);
                this.createLabel(stackLayout, "Make a quick movement with your phone in any direction. Marker will appear on the screen when the movement is detected.", 0);
                break;
            case TutorialState.MOVEMENT_LEARNING_START:
                this.tutorialLayout.removeChildren();
                var stackLayout = new stack_layout_1.StackLayout();
                this.tutorialLayout.addChild(stackLayout);
                this.createLabel(stackLayout, "Good job! Make a few more movements to get familiar with the movements that are detected.", 0);
                break;
            case TutorialState.MUSIC:
                this.tutorialLayout.removeChildren();
                var stackLayout = new stack_layout_1.StackLayout();
                this.tutorialLayout.addChild(stackLayout);
                this.createLabel(stackLayout, "Well done! Now lets add some music. Make the movement, when you hear a beat.", 0);
                this.player = new nativescript_audio_1.TNSPlayer();
                this.tutorialService.getData().map(function (json) { return json.content; }).subscribe(function (result) {
                    _this.selectedSong = result[0];
                    _this.playAudio(_this.selectedSong['url_music']);
                }, function (error) { return console.log(error); });
                break;
            case TutorialState.MUSIC_STARTED:
                this.tutorialLayout.removeChildren();
                var scoreLabel = this.createAbsoluteLabel("", 0, 0);
                var timeLabel = this.createAbsoluteLabel("", platform_1.screen.mainScreen.widthDIPs - 50, 0);
                setInterval(function () {
                    scoreLabel.text = "Score: " + _this.score;
                    timeLabel.text = (_this.songDuration - ((new Date().getTime() - _this.startTime) / 1000)).toFixed(0) + "s";
                }, 100);
                break;
            case TutorialState.FINISH:
                this.tutorialLayout.removeChildren();
                var stackLayout = new stack_layout_1.StackLayout();
                this.tutorialLayout.addChild(stackLayout);
                this.createLabel(stackLayout, "Nice beats! You are now ready to rock'n'roll!", 0);
                this.createLabel(stackLayout, "Score: " + this.score, 0);
                break;
        }
    };
    TutorialComponent.prototype.nextState = function () {
        if (this.currentState + 1 == 7) {
            // redirect back
            this.routerExtensions.navigate([""], { clearHistory: true });
            return;
        }
        this.currentState = TutorialState[TutorialState[this.currentState + 1]];
        this.updateState();
    };
    TutorialComponent.prototype.playAudio = function (filepath) {
        var _this = this;
        try {
            var playerOptions = {
                audioFile: filepath,
                loop: false,
                completeCallback: function () {
                    _this.nextState();
                    _this.player.dispose().then(function () {
                        console.log('TNSPlayer disposed.');
                    }, function (err) {
                        console.log('ERROR disposePlayer: ' + err);
                    });
                },
                errorCallback: function (err) {
                    console.log(err);
                },
                infoCallback: function (info) {
                    console.log("what: " + info);
                }
            };
            this.player.playFromUrl(playerOptions).then(function () {
                _this.startTime = new Date().getTime();
                _this.player.getAudioTrackDuration().then(function (result) {
                    _this.songDuration = +result;
                });
            }, function (err) {
                console.log(err);
            });
        }
        catch (ex) {
            console.log(ex);
        }
    };
    return TutorialComponent;
}());
TutorialComponent = __decorate([
    core_1.Component({
        selector: "tutorial",
        templateUrl: "pages/tutorial/tutorial.html",
        providers: [tutorial_services_1.TutorialService]
    }),
    __metadata("design:paramtypes", [nativescript_angular_1.RouterExtensions, tutorial_services_1.TutorialService, core_1.NgZone, page_1.Page])
], TutorialComponent);
exports.TutorialComponent = TutorialComponent;
var TutorialState;
(function (TutorialState) {
    TutorialState[TutorialState["INTRO"] = 1] = "INTRO";
    TutorialState[TutorialState["MOVEMENT_SINGLE"] = 2] = "MOVEMENT_SINGLE";
    TutorialState[TutorialState["MOVEMENT_LEARNING_START"] = 3] = "MOVEMENT_LEARNING_START";
    TutorialState[TutorialState["MUSIC"] = 4] = "MUSIC";
    TutorialState[TutorialState["MUSIC_STARTED"] = 5] = "MUSIC_STARTED";
    TutorialState[TutorialState["FINISH"] = 6] = "FINISH";
})(TutorialState || (TutorialState = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHV0b3JpYWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidHV0b3JpYWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxzQ0FBbUU7QUFDbkUsa0NBQStCO0FBQy9CLHdEQUFvRDtBQUNwRCxnQ0FBNkI7QUFFN0Isd0VBQThGO0FBRTlGLHlEQUFvRDtBQUNwRCx5REFBaUU7QUFDakUsNkRBQXNEO0FBQ3RELGtDQUF3QztBQUN4Qyw4REFBMEQ7QUFDMUQscUNBQWdDO0FBU2hDLElBQWEsaUJBQWlCO0lBc0IxQiwyQkFBb0IsZ0JBQWtDLEVBQVUsZUFBZ0MsRUFBVSxJQUFZLEVBQVUsSUFBVTtRQUF0SCxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQVUsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQVUsU0FBSSxHQUFKLElBQUksQ0FBUTtRQUFVLFNBQUksR0FBSixJQUFJLENBQU07UUFyQmxJLGlCQUFZLEdBQWtCLGFBQWEsQ0FBQyxLQUFLLENBQUM7UUFLbEQsaUJBQVksR0FBRyxDQUFDLENBQUM7UUFRekIsa0JBQWtCO1FBQ1YsVUFBSyxHQUFXLENBQUMsQ0FBQztRQUNsQixvQkFBZSxHQUFXLENBQUMsQ0FBQztJQU9wQyxDQUFDO0lBRU0sdUNBQVcsR0FBbEI7UUFDSSxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNwQyxDQUFDO0lBRU0scUNBQVMsR0FBaEI7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztJQUNyQixDQUFDO0lBRU0sb0NBQVEsR0FBZjtRQUNJLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLDJDQUFxQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3hELElBQUksQ0FBQyxjQUFjLEdBQW9CLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFD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QyxNQUFNLENBQUM7Z0JBQ2hDLENBQUMsQ0FBQyxDQUFDO1lBQ1AsQ0FBQyxFQUFFLFVBQUMsR0FBRztnQkFDSCxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3JCLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQztRQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDVixPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3BCLENBQUM7SUFDTCxDQUFDO0lBQ0wsd0JBQUM7QUFBRCxDQUFDLEFBcFFELElBb1FDO0FBcFFZLGlCQUFpQjtJQUw3QixnQkFBUyxDQUFDO1FBQ1AsUUFBUSxFQUFFLFVBQVU7UUFDcEIsV0FBVyxFQUFFLDhCQUE4QjtRQUMzQyxTQUFTLEVBQUUsQ0FBQyxtQ0FBZSxDQUFDO0tBQy9CLENBQUM7cUNBdUJ3Qyx1Q0FBZ0IsRUFBMkIsbUNBQWUsRUFBZ0IsYUFBTSxFQUFnQixXQUFJO0dBdEJqSSxpQkFBaUIsQ0FvUTdCO0FBcFFZLDhDQUFpQjtBQXNROUIsSUFBSyxhQU9KO0FBUEQsV0FBSyxhQUFhO0lBQ2QsbURBQVMsQ0FBQTtJQUNULHVFQUFtQixDQUFBO0lBQ25CLHVGQUEyQixDQUFBO0lBQzNCLG1EQUFTLENBQUE7SUFDVCxtRUFBaUIsQ0FBQTtJQUNqQixxREFBVSxDQUFBO0FBQ2QsQ0FBQyxFQVBJLGFBQWEsS0FBYixhQUFhLFFBT2pCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIE9uSW5pdCwgTmdab25lLCBPbkRlc3Ryb3l9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5pbXBvcnQge0xhYmVsfSBmcm9tIFwidWkvbGFiZWxcIjtcbmltcG9ydCB7U3RhY2tMYXlvdXR9IGZyb20gXCJ1aS9sYXlvdXRzL3N0YWNrLWxheW91dFwiO1xuaW1wb3J0IHtQYWdlfSBmcm9tIFwidWkvcGFnZVwiO1xuaW1wb3J0IHtBbmltYXRpb259IGZyb20gXCJ1aS9hbmltYXRpb25cIjtcbmltcG9ydCB7UXVpY2tHZXN0dXJlRGV0ZWN0aW9uLCBRdWlja0dlc3R1cmVEZXRlY3RhYmxlfSBmcm9tIFwiLi4vLi4vc2hhcmVkL2RldGVjdGlvbi5jb21wb25lbnRcIlxuaW1wb3J0IHtBY3Rpb25JdGVtfSBmcm9tIFwidWkvYWN0aW9uLWJhclwiO1xuaW1wb3J0IHtUdXRvcmlhbFNlcnZpY2V9IGZyb20gXCIuL3R1dG9yaWFsLnNlcnZpY2VzXCI7XG5pbXBvcnQge1ROU1BsYXllciwgQXVkaW9QbGF5ZXJPcHRpb25zfSBmcm9tIFwibmF0aXZlc2NyaXB0LWF1ZGlvXCI7XG5pbXBvcnQge1JvdXRlckV4dGVuc2lvbnN9IGZyb20gXCJuYXRpdmVzY3JpcHQtYW5ndWxhclwiO1xuaW1wb3J0IHtBbmltYXRpb25DdXJ2ZX0gZnJvbSBcInVpL2VudW1zXCI7XG5pbXBvcnQge0Fic29sdXRlTGF5b3V0fSBmcm9tIFwidWkvbGF5b3V0cy9hYnNvbHV0ZS1sYXlvdXRcIjtcbmltcG9ydCB7c2NyZWVufSBmcm9tIFwicGxhdGZvcm1cIjtcbmltcG9ydCB7TGF5b3V0QmFzZX0gZnJvbSBcInVpL2xheW91dHMvbGF5b3V0LWJhc2VcIjtcblxuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogXCJ0dXRvcmlhbFwiLFxuICAgIHRlbXBsYXRlVXJsOiBcInBhZ2VzL3R1dG9yaWFsL3R1dG9yaWFsLmh0bWxcIixcbiAgICBwcm92aWRlcnM6IFtUdXRvcmlhbFNlcnZpY2VdXG59KVxuZXhwb3J0IGNsYXNzIFR1dG9yaWFsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBRdWlja0dlc3R1cmVEZXRlY3RhYmxlLCBPbkRlc3Ryb3kge1xuICAgIHByaXZhdGUgY3VycmVudFN0YXRlOiBUdXRvcmlhbFN0YXRlID0gVHV0b3JpYWxTdGF0ZS5JTlRSTztcbiAgICBwcml2YXRlIHR1dG9yaWFsTGF5b3V0OiBBYnNvbHV0ZUxheW91dDtcblxuICAgIHByaXZhdGUgZ2VzdHVyZURldGVjdGlvbjogUXVpY2tHZXN0dXJlRGV0ZWN0aW9uO1xuXG4gICAgcHJpdmF0ZSBnZXN0dXJlQ291bnQgPSAxO1xuXG4gICAgcHJpdmF0ZSBwbGF5ZXI6IFROU1BsYXllcjtcblxuICAgIHByaXZhdGUgdHV0b3JpYWxBY3Rpb25JdGVtOiBBY3Rpb25JdGVtO1xuXG4gICAgcHJpdmF0ZSBzb25nRHVyYXRpb246IG51bWJlcjtcblxuICAgIC8vIHNjb3JlIHZhcmlhYmxlc1xuICAgIHByaXZhdGUgc2NvcmU6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBzY29yZU11bHRpcGxpZXI6IG51bWJlciA9IDE7XG5cbiAgICAvLyBiZWF0IHZhcmlhYmxlc1xuICAgIHByaXZhdGUgc3RhcnRUaW1lOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBzZWxlY3RlZFNvbmc7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJvdXRlckV4dGVuc2lvbnM6IFJvdXRlckV4dGVuc2lvbnMsIHByaXZhdGUgdHV0b3JpYWxTZXJ2aWNlOiBUdXRvcmlhbFNlcnZpY2UsIHByaXZhdGUgem9uZTogTmdab25lLCBwcml2YXRlIHBhZ2U6IFBhZ2UpIHtcbiAgICB9XG5cbiAgICBwdWJsaWMgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMucGxheWVyLnBhdXNlKCk7XG4gICAgICAgIHRoaXMuZ2VzdHVyZURldGVjdGlvbi5kZXN0cm95KCk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldE5nWm9uZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuem9uZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuZ2VzdHVyZURldGVjdGlvbiA9IG5ldyBRdWlja0dlc3R1cmVEZXRlY3Rpb24odGhpcyk7XG4gICAgICAgIHRoaXMudHV0b3JpYWxMYXlvdXQgPSA8QWJzb2x1dGVMYXlvdXQ+IHRoaXMucGFnZS5nZXRWaWV3QnlJZChcInR1dG9yaWFsTGF5b3V0XCIpO1xuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjcmVhdGVHZXN0dXJlRGV0ZWN0ZWRMYWJlbCh0ZXh0OiBzdHJpbmcsIGNvcnJlY3REZXRlY3Rpb246IGJvb2xlYW4gPSB0cnVlLCBkdXJhdGlvbjogbnVtYmVyID0gMjUwMCwgbWluaW11bU9wYWNpdHkgPSAwLCBleHBhbmQ6IG51bWJlciA9IDApIHtcbiAgICAgICAgdmFyIG1pbmltdW0gPSBNYXRoLm1pbihzY3JlZW4ubWFpblNjcmVlbi53aWR0aERJUHMsIHNjcmVlbi5tYWluU2NyZWVuLmhlaWdodERJUHMpO1xuXG4gICAgICAgIHZhciBsYWJlbCA9IG5ldyBMYWJlbCgpO1xuICAgICAgICBsYWJlbC50ZXh0V3JhcCA9IHRydWU7XG4gICAgICAgIGxhYmVsLmNzc0NsYXNzID0gY29ycmVjdERldGVjdGlvbiA/IFwiY29ycmVjdC1kZXRlY3Rpb25cIiA6IFwiZmFsc2UtZGV0ZWN0aW9uXCI7XG4gICAgICAgIGxhYmVsLnRleHQgPSB0ZXh0O1xuICAgICAgICBsYWJlbC5zdHlsZS53aWR0aCA9IG1pbmltdW0gLyAyICogKDEgKyBleHBhbmQpO1xuICAgICAgICBsYWJlbC5zdHlsZS5oZWlnaHQgPSBtaW5pbXVtIC8gMiAqICgxICsgZXhwYW5kKTtcbiAgICAgICAgbGFiZWwuc3R5bGUuYm9yZGVyUmFkaXVzID0gbWluaW11bSAvIDQgKiAoMSArIGV4cGFuZCk7XG4gICAgICAgIGxhYmVsLnN0eWxlLmZvbnRTaXplID0gMzUgKiAoMSArIGV4cGFuZCAvIDIpO1xuXG4gICAgICAgIEFic29sdXRlTGF5b3V0LnNldExlZnQobGFiZWwsIHNjcmVlbi5tYWluU2NyZWVuLndpZHRoRElQcyAvIDIgLSAobGFiZWwuc3R5bGUud2lkdGggLyAyKSk7XG4gICAgICAgIEFic29sdXRlTGF5b3V0LnNldFRvcChsYWJlbCwgc2NyZWVuLm1haW5TY3JlZW4uaGVpZ2h0RElQcyAvIDIgLSAobGFiZWwuc3R5bGUuaGVpZ2h0IC8gMikpO1xuICAgICAgICB0aGlzLnR1dG9yaWFsTGF5b3V0LmFkZENoaWxkKGxhYmVsKTtcblxuICAgICAgICB2YXIgYW5pbWF0aW9uOiBBbmltYXRpb24gPSBsYWJlbC5jcmVhdGVBbmltYXRpb24oe1xuICAgICAgICAgICAgb3BhY2l0eTogbWluaW11bU9wYWNpdHksXG4gICAgICAgICAgICBkdXJhdGlvbjogZHVyYXRpb24sXG4gICAgICAgICAgICBjdXJ2ZTogQW5pbWF0aW9uQ3VydmUuZWFzZUluXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBhbmltYXRpb24ucGxheSgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY3JlYXRlQWJzb2x1dGVMYWJlbCh0ZXh0OiBzdHJpbmcsIGxlZnQ6IG51bWJlciwgdG9wOiBudW1iZXIpIHtcbiAgICAgICAgdmFyIGxhYmVsID0gbmV3IExhYmVsKCk7XG4gICAgICAgIGxhYmVsLnRleHRXcmFwID0gdHJ1ZTtcbiAgICAgICAgbGFiZWwuc3R5bGUuZm9udFNpemUgPSAyNDtcbiAgICAgICAgbGFiZWwuc3R5bGUudGV4dEFsaWdubWVudCA9ICdsZWZ0JztcbiAgICAgICAgbGFiZWwudGV4dCA9IHRleHQ7XG4gICAgICAgIGxhYmVsLnN0eWxlLnpJbmRleCA9IDEwMDA7XG5cbiAgICAgICAgQWJzb2x1dGVMYXlvdXQuc2V0TGVmdChsYWJlbCwgbGVmdCk7XG4gICAgICAgIEFic29sdXRlTGF5b3V0LnNldFRvcChsYWJlbCwgdG9wKTtcbiAgICAgICAgdGhpcy50dXRvcmlhbExheW91dC5hZGRDaGlsZChsYWJlbCk7XG4gICAgICAgIHJldHVybiBsYWJlbDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNyZWF0ZUxhYmVsKGxheW91dDogTGF5b3V0QmFzZSwgdGV4dDogc3RyaW5nLCBkZWxheTogbnVtYmVyID0gMCkge1xuICAgICAgICB2YXIgbGFiZWwgPSBuZXcgTGFiZWwoKTtcbiAgICAgICAgbGFiZWwudGV4dFdyYXAgPSB0cnVlO1xuICAgICAgICBsYWJlbC5zdHlsZS5vcGFjaXR5ID0gMDtcbiAgICAgICAgbGFiZWwuc3R5bGUuZm9udFNpemUgPSAyNDtcbiAgICAgICAgbGFiZWwuc3R5bGUudGV4dEFsaWdubWVudCA9IFwibGVmdFwiO1xuICAgICAgICBsYWJlbC50ZXh0ID0gdGV4dDtcbiAgICAgICAgbGFiZWwuc3R5bGUubWFyZ2luID0gXCIxMFwiO1xuICAgICAgICBsYWJlbC5zdHlsZS53aWR0aCA9IHNjcmVlbi5tYWluU2NyZWVuLndpZHRoRElQcyAtIDEwO1xuXG4gICAgICAgIGlmIChkZWxheSAhPSAwKSB7XG4gICAgICAgICAgICBsYWJlbC5zdHlsZS5mb250V2VpZ2h0ID0gXCJib2xkXCI7XG4gICAgICAgICAgICBsYWJlbC5zdHlsZS5mb250U2l6ZSA9IDMyO1xuICAgICAgICB9XG5cbiAgICAgICAgbGF5b3V0LmFkZENoaWxkKGxhYmVsKTtcblxuICAgICAgICB2YXIgYW5pbWF0aW9uOiBBbmltYXRpb24gPSBsYWJlbC5jcmVhdGVBbmltYXRpb24oe1xuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIGR1cmF0aW9uOiA3NTAsXG4gICAgICAgICAgICBkZWxheTogZGVsYXlcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGFuaW1hdGlvbi5wbGF5KCk7XG4gICAgfVxuXG4gICAgcHVibGljIHF1aWNrR2VzdHVyZURldGVjdGVkKCkge1xuICAgICAgICBzd2l0Y2ggKHRoaXMuY3VycmVudFN0YXRlKSB7XG4gICAgICAgICAgICBjYXNlIFR1dG9yaWFsU3RhdGUuTU9WRU1FTlRfU0lOR0xFOlxuICAgICAgICAgICAgICAgIHRoaXMudHV0b3JpYWxMYXlvdXQucmVtb3ZlQ2hpbGRyZW4oKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUdlc3R1cmVEZXRlY3RlZExhYmVsKFwiTW92ZW1lbnQgZGV0ZWN0ZWQhXCIsIHRydWUsIDE1MDAsIDEsIDAuNSlcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0U3RhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFR1dG9yaWFsU3RhdGUuTU9WRU1FTlRfTEVBUk5JTkdfU1RBUlQ6XG4gICAgICAgICAgICAgICAgdGhpcy50dXRvcmlhbExheW91dC5yZW1vdmVDaGlsZHJlbigpO1xuICAgICAgICAgICAgICAgIHRoaXMuZ2VzdHVyZUNvdW50Kys7XG4gICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVHZXN0dXJlRGV0ZWN0ZWRMYWJlbCh0aGlzLmdlc3R1cmVDb3VudCArIFwiIC8gMTBcIiwgdHJ1ZSwgMjUwMCwgMCwgMCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2VzdHVyZUNvdW50ID09IDEwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmV4dFN0YXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBUdXRvcmlhbFN0YXRlLk1VU0lDOlxuICAgICAgICAgICAgICAgIHRoaXMubmV4dFN0YXRlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5xdWlja0dlc3R1cmVEZXRlY3RlZCgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBUdXRvcmlhbFN0YXRlLk1VU0lDX1NUQVJURUQ6XG4gICAgICAgICAgICAgICAgdmFyIGFjdHVhbEJlYXRFeGlzdHM6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2YXIgdGltZVNpbmNlU3RhcnRJblNlY29uZHM6IG51bWJlciA9IChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMuc3RhcnRUaW1lKSAvIDEwMDA7XG5cbiAgICAgICAgICAgICAgICB2YXIgYmVhdHMgPSB0aGlzLnNlbGVjdGVkU29uZ1snYmVhdHMnXS5zcGxpdChcIixcIikubWFwKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gK3ZhbHVlO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgYmVhdCBvZiBiZWF0cykge1xuICAgICAgICAgICAgICAgICAgICAvLyBiZWF0IGF0IGN1cnJlbnQgdGltZSBkZXRlY3RlZFxuICAgICAgICAgICAgICAgICAgICB2YXIgZGlmZiA9IE1hdGguYWJzKGJlYXQgLSB0aW1lU2luY2VTdGFydEluU2Vjb25kcyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkaWZmIDwgMC4yNSkgeyAvLyBlYXN5IG1vZGVcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdHVhbEJlYXRFeGlzdHMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGFjdHVhbEJlYXRFeGlzdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY29yZSArPSB0aGlzLnNjb3JlTXVsdGlwbGllcjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY29yZU11bHRpcGxpZXIrKztcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjb3JlTXVsdGlwbGllciA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlR2VzdHVyZURldGVjdGVkTGFiZWwoYWN0dWFsQmVhdEV4aXN0cyA/IFwiK1wiICsgdGhpcy5zY29yZU11bHRpcGxpZXIgOiBcIk1pc3NlZCFcIiwgYWN0dWFsQmVhdEV4aXN0cywgMjUwMCwgMCwgdGhpcy5zY29yZU11bHRpcGxpZXIgLyAxMCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIHVwZGF0ZVN0YXRlKCkge1xuICAgICAgICBzd2l0Y2ggKHRoaXMuY3VycmVudFN0YXRlKSB7XG4gICAgICAgICAgICBjYXNlIFR1dG9yaWFsU3RhdGUuSU5UUk86XG4gICAgICAgICAgICAgICAgdmFyIHN0YWNrTGF5b3V0ID0gbmV3IFN0YWNrTGF5b3V0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy50dXRvcmlhbExheW91dC5hZGRDaGlsZChzdGFja0xheW91dCk7XG4gICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVMYWJlbChzdGFja0xheW91dCwgXCJXYW50IHRvIGRhbmNlIHdpdGggeW91ciBjcnVzaD9cIiwgMClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlTGFiZWwoc3RhY2tMYXlvdXQsIFwiV2FudCB0byBleHBlcmllbmNlIGFuZCBsaXN0ZW4gdG8gbXVzaWMgaW4gYSBjb21wbGV0ZWx5IG5ldyB3YXk/XCIsIDApO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVMYWJlbChzdGFja0xheW91dCwgXCJXYW50IHRvIGxlYXJuIGFuIGluc3RydW1lbnQ/XCIsIDApO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVMYWJlbChzdGFja0xheW91dCwgXCJZb3UgbmVlZCB0byBsZWFybiByaHl0aG0gZmlyc3QhXCIsIDEwMDApO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgVHV0b3JpYWxTdGF0ZS5NT1ZFTUVOVF9TSU5HTEU6XG4gICAgICAgICAgICAgICAgdGhpcy50dXRvcmlhbExheW91dC5yZW1vdmVDaGlsZHJlbigpO1xuICAgICAgICAgICAgICAgIHZhciBzdGFja0xheW91dCA9IG5ldyBTdGFja0xheW91dCgpO1xuICAgICAgICAgICAgICAgIHRoaXMudHV0b3JpYWxMYXlvdXQuYWRkQ2hpbGQoc3RhY2tMYXlvdXQpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlTGFiZWwoc3RhY2tMYXlvdXQsIFwiTWFrZSBhIHF1aWNrIG1vdmVtZW50IHdpdGggeW91ciBwaG9uZSBpbiBhbnkgZGlyZWN0aW9uLiBNYXJrZXIgd2lsbCBhcHBlYXIgb24gdGhlIHNjcmVlbiB3aGVuIHRoZSBtb3ZlbWVudCBpcyBkZXRlY3RlZC5cIiwgMCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFR1dG9yaWFsU3RhdGUuTU9WRU1FTlRfTEVBUk5JTkdfU1RBUlQ6XG4gICAgICAgICAgICAgICAgdGhpcy50dXRvcmlhbExheW91dC5yZW1vdmVDaGlsZHJlbigpO1xuICAgICAgICAgICAgICAgIHZhciBzdGFja0xheW91dCA9IG5ldyBTdGFja0xheW91dCgpO1xuICAgICAgICAgICAgICAgIHRoaXMudHV0b3JpYWxMYXlvdXQuYWRkQ2hpbGQoc3RhY2tMYXlvdXQpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlTGFiZWwoc3RhY2tMYXlvdXQsIFwiR29vZCBqb2IhIE1ha2UgYSBmZXcgbW9yZSBtb3ZlbWVudHMgdG8gZ2V0IGZhbWlsaWFyIHdpdGggdGhlIG1vdmVtZW50cyB0aGF0IGFyZSBkZXRlY3RlZC5cIiwgMCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFR1dG9yaWFsU3RhdGUuTVVTSUM6XG4gICAgICAgICAgICAgICAgdGhpcy50dXRvcmlhbExheW91dC5yZW1vdmVDaGlsZHJlbigpO1xuICAgICAgICAgICAgICAgIHZhciBzdGFja0xheW91dCA9IG5ldyBTdGFja0xheW91dCgpO1xuICAgICAgICAgICAgICAgIHRoaXMudHV0b3JpYWxMYXlvdXQuYWRkQ2hpbGQoc3RhY2tMYXlvdXQpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlTGFiZWwoc3RhY2tMYXlvdXQsIFwiV2VsbCBkb25lISBOb3cgbGV0cyBhZGQgc29tZSBtdXNpYy4gTWFrZSB0aGUgbW92ZW1lbnQsIHdoZW4geW91IGhlYXIgYSBiZWF0LlwiLCAwKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllciA9IG5ldyBUTlNQbGF5ZXIoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnR1dG9yaWFsU2VydmljZS5nZXREYXRhKCkubWFwKGpzb24gPT4ganNvbi5jb250ZW50KS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgICAgIChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRTb25nID0gcmVzdWx0WzBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5QXVkaW8odGhpcy5zZWxlY3RlZFNvbmdbJ3VybF9tdXNpYyddKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgKGVycm9yKSA9PiBjb25zb2xlLmxvZyhlcnJvcilcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBUdXRvcmlhbFN0YXRlLk1VU0lDX1NUQVJURUQ6XG4gICAgICAgICAgICAgICAgdGhpcy50dXRvcmlhbExheW91dC5yZW1vdmVDaGlsZHJlbigpO1xuICAgICAgICAgICAgICAgIHZhciBzY29yZUxhYmVsID0gdGhpcy5jcmVhdGVBYnNvbHV0ZUxhYmVsKFwiXCIsIDAsIDApO1xuICAgICAgICAgICAgICAgIHZhciB0aW1lTGFiZWwgPSB0aGlzLmNyZWF0ZUFic29sdXRlTGFiZWwoXCJcIiwgc2NyZWVuLm1haW5TY3JlZW4ud2lkdGhESVBzIC0gNTAsIDApO1xuICAgICAgICAgICAgICAgIHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcmVMYWJlbC50ZXh0ID0gXCJTY29yZTogXCIgKyB0aGlzLnNjb3JlO1xuICAgICAgICAgICAgICAgICAgICB0aW1lTGFiZWwudGV4dCA9ICh0aGlzLnNvbmdEdXJhdGlvbiAtICgobmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLnN0YXJ0VGltZSkgLyAxMDAwKSkudG9GaXhlZCgwKSArIFwic1wiO1xuICAgICAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFR1dG9yaWFsU3RhdGUuRklOSVNIOlxuICAgICAgICAgICAgICAgIHRoaXMudHV0b3JpYWxMYXlvdXQucmVtb3ZlQ2hpbGRyZW4oKTtcbiAgICAgICAgICAgICAgICB2YXIgc3RhY2tMYXlvdXQgPSBuZXcgU3RhY2tMYXlvdXQoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnR1dG9yaWFsTGF5b3V0LmFkZENoaWxkKHN0YWNrTGF5b3V0KTtcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUxhYmVsKHN0YWNrTGF5b3V0LCBcIk5pY2UgYmVhdHMhIFlvdSBhcmUgbm93IHJlYWR5IHRvIHJvY2snbidyb2xsIVwiLCAwKTtcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUxhYmVsKHN0YWNrTGF5b3V0LCBcIlNjb3JlOiBcIiArIHRoaXMuc2NvcmUsIDApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBuZXh0U3RhdGUoKSB7XG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRTdGF0ZSArIDEgPT0gNykge1xuICAgICAgICAgICAgLy8gcmVkaXJlY3QgYmFja1xuICAgICAgICAgICAgdGhpcy5yb3V0ZXJFeHRlbnNpb25zLm5hdmlnYXRlKFtcIlwiXSwge2NsZWFySGlzdG9yeTogdHJ1ZX0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY3VycmVudFN0YXRlID0gVHV0b3JpYWxTdGF0ZVtUdXRvcmlhbFN0YXRlW3RoaXMuY3VycmVudFN0YXRlICsgMV1dO1xuICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBwbGF5QXVkaW8oZmlsZXBhdGg6IHN0cmluZykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIHBsYXllck9wdGlvbnM6IEF1ZGlvUGxheWVyT3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICBhdWRpb0ZpbGU6IGZpbGVwYXRoLFxuICAgICAgICAgICAgICAgIGxvb3A6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGNvbXBsZXRlQ2FsbGJhY2s6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0U3RhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIuZGlzcG9zZSgpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1ROU1BsYXllciBkaXNwb3NlZC4nKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0VSUk9SIGRpc3Bvc2VQbGF5ZXI6ICcgKyBlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgZXJyb3JDYWxsYmFjazogKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBpbmZvQ2FsbGJhY2s6IChpbmZvKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwid2hhdDogXCIgKyBpbmZvKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgIHRoaXMucGxheWVyLnBsYXlGcm9tVXJsKHBsYXllck9wdGlvbnMpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXIuZ2V0QXVkaW9UcmFja0R1cmF0aW9uKCkudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc29uZ0R1cmF0aW9uID0gK3Jlc3VsdDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sIChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhleCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmVudW0gVHV0b3JpYWxTdGF0ZSB7XG4gICAgSU5UUk8gPSAxLFxuICAgIE1PVkVNRU5UX1NJTkdMRSA9IDIsXG4gICAgTU9WRU1FTlRfTEVBUk5JTkdfU1RBUlQgPSAzLFxuICAgIE1VU0lDID0gNCxcbiAgICBNVVNJQ19TVEFSVEVEID0gNSxcbiAgICBGSU5JU0ggPSA2XG59Il19