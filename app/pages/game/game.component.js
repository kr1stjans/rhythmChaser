"use strict";
var core_1 = require("@angular/core");
var page_1 = require("ui/page");
var nativescript_audio_1 = require("nativescript-audio");
var label_1 = require("ui/label");
var absolute_layout_1 = require("ui/layouts/absolute-layout");
var detection_component_1 = require("../../shared/detection.component");
var music_services_1 = require("./music.services");
var platform_1 = require("platform");
var enums_1 = require("ui/enums");
var nativescript_angular_1 = require("nativescript-angular");
var score_services_1 = require("./score.services");
var GameComponent = (function () {
    function GameComponent(scoreService, routerExtensions, musicService, zone, page) {
        this.scoreService = scoreService;
        this.routerExtensions = routerExtensions;
        this.musicService = musicService;
        this.zone = zone;
        this.page = page;
        // score variables
        this.score = 0;
        this.scoreMultiplier = 1;
        this.songList = [];
    }
    /**
     * Clear song picker and init gesture & audio player.
     */
    GameComponent.prototype.listViewItemTap = function (args) {
        var _this = this;
        this.quickGestureDetection = new detection_component_1.QuickGestureDetection(this);
        this.player = new nativescript_audio_1.TNSPlayer();
        this.selectedSong = this.songList[args.index];
        this.playAudio(this.selectedSong['url_music']);
        this.scoresLayout.removeChildren();
        var scoreLabel = this.createAbsoluteLabel("", 0, 0);
        var timeLabel = this.createAbsoluteLabel("", platform_1.screen.mainScreen.widthDIPs - 60, 0);
        this.updateCallback = setInterval(function () {
            scoreLabel.text = "Score: " + _this.score;
            if (_this.songDuration != null) {
                timeLabel.text = (_this.songDuration - ((new Date().getTime() - _this.startTime) / 1000)).toFixed(0) + "s";
            }
        }, 100);
        this.scoresLayout.on("tap", function () {
            _this.quickGestureDetected();
        });
    };
    GameComponent.prototype.onItemLoading = function (args) {
        if (args.ios) {
            // args.ios is instance of UITableViewCell
            args.ios.selectionStyle = 0; // UITableViewCellSelectionStyle.UITableViewCellSelectionStyleNone;
        }
    };
    /**
     * Init song picker and fetch songs from backend.
     */
    GameComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.scoresLayout = this.page.getViewById("scoresLayout");
        this.musicService.getData().map(function (json) { return json.content; }).subscribe(function (result) {
            _this.songList = result;
        }, function (error) { return console.log(error); });
    };
    GameComponent.prototype.quickGestureDetected = function () {
        var actualBeatExists = false;
        var timeSinceStartInSeconds = (new Date().getTime() - this.startTime) / 1000;
        var beats = this.selectedSong['beats'].split(",").map(function (value) {
            return +value;
        });
        for (var _i = 0, beats_1 = beats; _i < beats_1.length; _i++) {
            var beat = beats_1[_i];
            // beat at current time detected
            var diff = Math.abs(beat - timeSinceStartInSeconds);
            if (diff < 0.12) {
                actualBeatExists = true;
                break;
            }
        }
        if (actualBeatExists) {
            this.score += this.scoreMultiplier;
            this.scoreMultiplier++;
        }
        else {
            this.scoreMultiplier = 0;
        }
        this.createGestureDetectedLabel(actualBeatExists ? "+" + this.scoreMultiplier : "Missed!", actualBeatExists, 2500, 0, this.scoreMultiplier / 10);
    };
    GameComponent.prototype.createGestureDetectedLabel = function (text, correctDetection, duration, minimumOpacity, expand) {
        if (correctDetection === void 0) { correctDetection = true; }
        if (duration === void 0) { duration = 2500; }
        if (minimumOpacity === void 0) { minimumOpacity = 0; }
        if (expand === void 0) { expand = 0; }
        var minimum = Math.min(platform_1.screen.mainScreen.widthDIPs, platform_1.screen.mainScreen.heightDIPs);
        var label = new label_1.Label();
        label.textWrap = true;
        label.cssClass = correctDetection ? "correct-detection" : "false-detection";
        label.text = text;
        label.style.width = minimum / 2 * (1 + expand);
        label.style.height = minimum / 2 * (1 + expand);
        label.style.borderRadius = minimum / 4 * (1 + expand);
        label.style.fontSize = 35 * (1 + expand / 2);
        absolute_layout_1.AbsoluteLayout.setLeft(label, platform_1.screen.mainScreen.widthDIPs / 2 - (label.style.width / 2));
        absolute_layout_1.AbsoluteLayout.setTop(label, platform_1.screen.mainScreen.heightDIPs / 2 - (label.style.height / 2));
        this.scoresLayout.addChild(label);
        var animation = label.createAnimation({
            opacity: minimumOpacity,
            duration: duration,
            curve: enums_1.AnimationCurve.easeIn
        });
        return animation.play();
    };
    GameComponent.prototype.createAbsoluteLabel = function (text, left, top) {
        var label = new label_1.Label();
        label.textWrap = true;
        label.style.fontSize = 24;
        label.style.textAlignment = 'left';
        label.text = text;
        label.style.zIndex = 1000;
        absolute_layout_1.AbsoluteLayout.setLeft(label, left);
        absolute_layout_1.AbsoluteLayout.setTop(label, top);
        this.scoresLayout.addChild(label);
        return label;
    };
    GameComponent.prototype.ngOnDestroy = function () {
        this.player.pause();
        this.quickGestureDetection.destroy();
    };
    GameComponent.prototype.getNgZone = function () {
        return this.zone;
    };
    GameComponent.prototype.playAudio = function (filepath) {
        var _this = this;
        try {
            var playerOptions = {
                audioFile: filepath,
                loop: false,
                completeCallback: function () {
                    clearInterval(_this.updateCallback);
                    _this.scoreService.updateScore(platform_1.device.uuid, _this.selectedSong['id'], _this.score);
                    _this.player.dispose().then(function () {
                        console.log('DISPOSED');
                    }, function (err) {
                        console.log('ERROR disposePlayer: ' + err);
                    });
                    _this.routerExtensions.navigate([""], { clearHistory: true });
                },
                errorCallback: function (err) {
                    console.log(err);
                },
                infoCallback: function (info) {
                    console.log("what: " + info);
                }
            };
            this.player.playFromUrl(playerOptions).then(function () {
                _this.startTime = new Date().getTime();
                _this.player.getAudioTrackDuration().then(function (result) {
                    _this.songDuration = +result;
                });
            }, function (err) {
                console.log(err);
            });
        }
        catch (ex) {
            console.log(ex);
        }
    };
    return GameComponent;
}());
GameComponent = __decorate([
    core_1.Component({
        selector: "game",
        templateUrl: "pages/game/game.html",
        providers: [music_services_1.MusicService, score_services_1.ScoreService]
    }),
    __metadata("design:paramtypes", [score_services_1.ScoreService, nativescript_angular_1.RouterExtensions, music_services_1.MusicService, core_1.NgZone, page_1.Page])
], GameComponent);
exports.GameComponent = GameComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FtZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJnYW1lLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsc0NBQW1FO0FBQ25FLGdDQUE2QjtBQUU3Qix5REFBaUU7QUFFakUsa0NBQStCO0FBRS9CLDhEQUEwRDtBQUcxRCx3RUFBK0Y7QUFDL0YsbURBQThDO0FBRTlDLHFDQUF3QztBQUN4QyxrQ0FBd0M7QUFJeEMsNkRBQXNEO0FBQ3RELG1EQUE4QztBQVE5QyxJQUFhLGFBQWE7SUFvQnRCLHVCQUFvQixZQUEwQixFQUFVLGdCQUFrQyxFQUFVLFlBQTBCLEVBQVUsSUFBWSxFQUFVLElBQVU7UUFBcEosaUJBQVksR0FBWixZQUFZLENBQWM7UUFBVSxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBQVUsaUJBQVksR0FBWixZQUFZLENBQWM7UUFBVSxTQUFJLEdBQUosSUFBSSxDQUFRO1FBQVUsU0FBSSxHQUFKLElBQUksQ0FBTTtRQWR4SyxrQkFBa0I7UUFDVixVQUFLLEdBQVcsQ0FBQyxDQUFDO1FBQ2xCLG9CQUFlLEdBQVcsQ0FBQyxDQUFDO1FBUTVCLGFBQVEsR0FBa0IsRUFBRSxDQUFDO0lBS3JDLENBQUM7SUFFRDs7T0FFRztJQUNLLHVDQUFlLEdBQXZCLFVBQXdCLElBQUk7UUFBNUIsaUJBb0JDO1FBbEJHLElBQUksQ0FBQyxxQkFBcUIsR0FBRyxJQUFJLDJDQUFxQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzdELElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSw4QkFBUyxFQUFFLENBQUM7UUFDOUIsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztRQUUvQyxJQUFJLENBQUMsWUFBWSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ25DLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3BELElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxFQUFFLEVBQUUsaUJBQU0sQ0FBQyxVQUFVLENBQUMsU0FBUyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNsRixJQUFJLENBQUMsY0FBYyxHQUFHLFdBQVcsQ0FBQztZQUM5QixVQUFVLENBQUMsSUFBSSxHQUFHLFNBQVMsR0FBRyxLQUFJLENBQUMsS0FBSyxDQUFDO1lBQ3pDLEVBQUUsQ0FBQyxDQUFDLEtBQUksQ0FBQyxZQUFZLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDNUIsU0FBUyxDQUFDLElBQUksR0FBRyxDQUFDLEtBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLEdBQUcsS0FBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztZQUM3RyxDQUFDO1FBQ0wsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBRVIsSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFO1lBQ3hCLEtBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1FBQ2hDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVNLHFDQUFhLEdBQXBCLFVBQXFCLElBQW1CO1FBQ3BDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ1gsMENBQTBDO1lBQzFDLElBQUksQ0FBQyxHQUFHLENBQUMsY0FBYyxHQUFHLENBQUMsQ0FBQyxDQUFFLG1FQUFtRTtRQUNyRyxDQUFDO0lBQ0wsQ0FBQztJQUVEOztPQUVHO0lBQ0ksZ0NBQVEsR0FBZjtRQUFBLGlCQVFDO1FBUEcsSUFBSSxDQUFDLFlBQVksR0FBaUIsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDeEUsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxHQUFHLENBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxJQUFJLENBQUMsT0FBTyxFQUFaLENBQVksQ0FBQyxDQUFDLFNBQVMsQ0FDM0QsVUFBQyxNQUFNO1lBQ0gsS0FBSSxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUM7UUFDM0IsQ0FBQyxFQUNELFVBQUMsS0FBSyxJQUFLLE9BQUEsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBbEIsQ0FBa0IsQ0FDaEMsQ0FBQztJQUNOLENBQUM7SUFFTSw0Q0FBb0IsR0FBM0I7UUFDSSxJQUFJLGdCQUFnQixHQUFZLEtBQUssQ0FBQztRQUN0QyxJQUFJLHVCQUF1QixHQUFXLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDO1FBRXJGLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEtBQUs7WUFDakUsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDO1FBQ2xCLENBQUMsQ0FBQyxDQUFDO1FBRUgsR0FBRyxDQUFDLENBQWEsVUFBSyxFQUFMLGVBQUssRUFBTCxtQkFBSyxFQUFMLElBQUs7WUFBakIsSUFBSSxJQUFJLGNBQUE7WUFDVCxnQ0FBZ0M7WUFDaEMsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsdUJBQXVCLENBQUMsQ0FBQztZQUNwRCxFQUFFLENBQUMsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDZCxnQkFBZ0IsR0FBRyxJQUFJLENBQUM7Z0JBQ3hCLEtBQUssQ0FBQztZQUNWLENBQUM7U0FDSjtRQUNELEVBQUUsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztZQUNuQixJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxlQUFlLENBQUM7WUFDbkMsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQzNCLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNKLElBQUksQ0FBQyxlQUFlLEdBQUcsQ0FBQyxDQUFDO1FBQzdCLENBQUM7UUFDRCxJQUFJLENBQUMsMEJBQTBCLENBQUMsZ0JBQWdCLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQyxlQUFlLEdBQUcsU0FBUyxFQUFFLGdCQUFnQixFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLGVBQWUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNySixDQUFDO0lBRU8sa0RBQTBCLEdBQWxDLFVBQW1DLElBQVksRUFBRSxnQkFBZ0MsRUFBRSxRQUF1QixFQUFFLGNBQWtCLEVBQUUsTUFBa0I7UUFBakcsaUNBQUEsRUFBQSx1QkFBZ0M7UUFBRSx5QkFBQSxFQUFBLGVBQXVCO1FBQUUsK0JBQUEsRUFBQSxrQkFBa0I7UUFBRSx1QkFBQSxFQUFBLFVBQWtCO1FBQzlJLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsaUJBQU0sQ0FBQyxVQUFVLENBQUMsU0FBUyxFQUFFLGlCQUFNLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRWxGLElBQUksS0FBSyxHQUFHLElBQUksYUFBSyxFQUFFLENBQUM7UUFDeEIsS0FBSyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDdEIsS0FBSyxDQUFDLFFBQVEsR0FBRyxnQkFBZ0IsR0FBRyxtQkFBbUIsR0FBRyxpQkFBaUIsQ0FBQztRQUM1RSxLQUFLLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNsQixLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxPQUFPLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDO1FBQy9DLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLE9BQU8sR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUM7UUFDaEQsS0FBSyxDQUFDLEtBQUssQ0FBQyxZQUFZLEdBQUcsT0FBTyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQztRQUN0RCxLQUFLLENBQUMsS0FBSyxDQUFDLFFBQVEsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBRTdDLGdDQUFjLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxpQkFBTSxDQUFDLFVBQVUsQ0FBQyxTQUFTLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6RixnQ0FBYyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsaUJBQU0sQ0FBQyxVQUFVLENBQUMsVUFBVSxHQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUYsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFbEMsSUFBSSxTQUFTLEdBQWMsS0FBSyxDQUFDLGVBQWUsQ0FBQztZQUM3QyxPQUFPLEVBQUUsY0FBYztZQUN2QixRQUFRLEVBQUUsUUFBUTtZQUNsQixLQUFLLEVBQUUsc0JBQWMsQ0FBQyxNQUFNO1NBQy9CLENBQUMsQ0FBQztRQUVILE1BQU0sQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDNUIsQ0FBQztJQUVPLDJDQUFtQixHQUEzQixVQUE0QixJQUFZLEVBQUUsSUFBWSxFQUFFLEdBQVc7UUFDL0QsSUFBSSxLQUFLLEdBQUcsSUFBSSxhQUFLLEVBQUUsQ0FBQztRQUN4QixLQUFLLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUN0QixLQUFLLENBQUMsS0FBSyxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDMUIsS0FBSyxDQUFDLEtBQUssQ0FBQyxhQUFhLEdBQUcsTUFBTSxDQUFDO1FBQ25DLEtBQUssQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztRQUUxQixnQ0FBYyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDcEMsZ0NBQWMsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2xDLE1BQU0sQ0FBQyxLQUFLLENBQUM7SUFDakIsQ0FBQztJQUVNLG1DQUFXLEdBQWxCO1FBQ0ksSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMscUJBQXFCLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDekMsQ0FBQztJQUVNLGlDQUFTLEdBQWhCO1FBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDckIsQ0FBQztJQUVPLGlDQUFTLEdBQWpCLFVBQWtCLFFBQWdCO1FBQWxDLGlCQXFDQztRQXBDRyxJQUFJLENBQUM7WUFDRCxJQUFJLGFBQWEsR0FBdUI7Z0JBQ3BDLFNBQVMsRUFBRSxRQUFRO2dCQUNuQixJQUFJLEVBQUUsS0FBSztnQkFDWCxnQkFBZ0IsRUFBRTtvQkFDZCxhQUFhLENBQUMsS0FBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO29CQUNuQyxLQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxpQkFBTSxDQUFDLElBQUksRUFBRSxLQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFDaEYsS0FBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUM7d0JBQ3ZCLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7b0JBQzVCLENBQUMsRUFBRSxVQUFDLEdBQUc7d0JBQ0gsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsR0FBRyxHQUFHLENBQUMsQ0FBQztvQkFDL0MsQ0FBQyxDQUFDLENBQUM7b0JBQ0gsS0FBSSxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUMsWUFBWSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7Z0JBQy9ELENBQUM7Z0JBRUQsYUFBYSxFQUFFLFVBQUMsR0FBRztvQkFDZixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNyQixDQUFDO2dCQUVELFlBQVksRUFBRSxVQUFDLElBQUk7b0JBQ2YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLENBQUM7Z0JBQ2pDLENBQUM7YUFDSixDQUFDO1lBR0YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUN4QyxLQUFJLENBQUMsU0FBUyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ3RDLEtBQUksQ0FBQyxNQUFNLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBQyxNQUFNO29CQUM1QyxLQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsTUFBTSxDQUFDO2dCQUNoQyxDQUFDLENBQUMsQ0FBQztZQUNQLENBQUMsRUFBRSxVQUFDLEdBQUc7Z0JBQ0gsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNyQixDQUFDLENBQUMsQ0FBQztRQUNQLENBQUM7UUFBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ1YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNwQixDQUFDO0lBQ0wsQ0FBQztJQUNMLG9CQUFDO0FBQUQsQ0FBQyxBQW5MRCxJQW1MQztBQW5MWSxhQUFhO0lBTHpCLGdCQUFTLENBQUM7UUFDUCxRQUFRLEVBQUUsTUFBTTtRQUNoQixXQUFXLEVBQUUsc0JBQXNCO1FBQ25DLFNBQVMsRUFBRSxDQUFDLDZCQUFZLEVBQUUsNkJBQVksQ0FBQztLQUMxQyxDQUFDO3FDQXFCb0MsNkJBQVksRUFBNEIsdUNBQWdCLEVBQXdCLDZCQUFZLEVBQWdCLGFBQU0sRUFBZ0IsV0FBSTtHQXBCL0osYUFBYSxDQW1MekI7QUFuTFksc0NBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbXBvbmVudCwgTmdab25lLCBPbkluaXQsIE9uRGVzdHJveX0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7UGFnZX0gZnJvbSBcInVpL3BhZ2VcIjtcblxuaW1wb3J0IHtUTlNQbGF5ZXIsIEF1ZGlvUGxheWVyT3B0aW9uc30gZnJvbSAnbmF0aXZlc2NyaXB0LWF1ZGlvJztcblxuaW1wb3J0IHtMYWJlbH0gZnJvbSBcInVpL2xhYmVsXCI7XG5pbXBvcnQge3Byb21wdCwgaW5wdXRUeXBlfSBmcm9tIFwidWkvZGlhbG9nc1wiO1xuaW1wb3J0IHtBYnNvbHV0ZUxheW91dH0gZnJvbSBcInVpL2xheW91dHMvYWJzb2x1dGUtbGF5b3V0XCI7XG5pbXBvcnQge0FuaW1hdGlvbn0gZnJvbSBcInVpL2FuaW1hdGlvblwiO1xuaW1wb3J0IHtMaXN0UGlja2VyfSBmcm9tIFwidWkvbGlzdC1waWNrZXJcIjtcbmltcG9ydCB7UXVpY2tHZXN0dXJlRGV0ZWN0YWJsZSwgUXVpY2tHZXN0dXJlRGV0ZWN0aW9ufSBmcm9tIFwiLi4vLi4vc2hhcmVkL2RldGVjdGlvbi5jb21wb25lbnRcIjtcbmltcG9ydCB7TXVzaWNTZXJ2aWNlfSBmcm9tIFwiLi9tdXNpYy5zZXJ2aWNlc1wiO1xuaW1wb3J0IHtTdGFja0xheW91dH0gZnJvbSBcInVpL2xheW91dHMvc3RhY2stbGF5b3V0XCI7XG5pbXBvcnQge3NjcmVlbiwgZGV2aWNlfSBmcm9tIFwicGxhdGZvcm1cIjtcbmltcG9ydCB7QW5pbWF0aW9uQ3VydmV9IGZyb20gXCJ1aS9lbnVtc1wiO1xuaW1wb3J0IHtMaXN0Vmlld30gZnJvbSBcInVpL2xpc3Qtdmlld1wiO1xuaW1wb3J0IHtJdGVtRXZlbnREYXRhfSBmcm9tIFwidWkvbGlzdC12aWV3XCI7XG5pbXBvcnQge0xheW91dEJhc2V9IGZyb20gXCJ1aS9sYXlvdXRzL2xheW91dC1iYXNlXCI7XG5pbXBvcnQge1JvdXRlckV4dGVuc2lvbnN9IGZyb20gXCJuYXRpdmVzY3JpcHQtYW5ndWxhclwiO1xuaW1wb3J0IHtTY29yZVNlcnZpY2V9IGZyb20gXCIuL3Njb3JlLnNlcnZpY2VzXCI7XG5cblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6IFwiZ2FtZVwiLFxuICAgIHRlbXBsYXRlVXJsOiBcInBhZ2VzL2dhbWUvZ2FtZS5odG1sXCIsXG4gICAgcHJvdmlkZXJzOiBbTXVzaWNTZXJ2aWNlLCBTY29yZVNlcnZpY2VdXG59KVxuZXhwb3J0IGNsYXNzIEdhbWVDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgUXVpY2tHZXN0dXJlRGV0ZWN0YWJsZSB7XG4gICAgcHJpdmF0ZSBwbGF5ZXI6IFROU1BsYXllcjtcbiAgICBwcml2YXRlIHNjb3Jlc0xheW91dDogQWJzb2x1dGVMYXlvdXQ7XG5cbiAgICBwcml2YXRlIHF1aWNrR2VzdHVyZURldGVjdGlvbjogUXVpY2tHZXN0dXJlRGV0ZWN0aW9uO1xuXG4gICAgLy8gc2NvcmUgdmFyaWFibGVzXG4gICAgcHJpdmF0ZSBzY29yZTogbnVtYmVyID0gMDtcbiAgICBwcml2YXRlIHNjb3JlTXVsdGlwbGllcjogbnVtYmVyID0gMTtcblxuICAgIHByaXZhdGUgc2VsZWN0ZWRTb25nO1xuXG4gICAgLy8gYmVhdCB2YXJpYWJsZXNcbiAgICBwcml2YXRlIHN0YXJ0VGltZTogbnVtYmVyO1xuICAgIHByaXZhdGUgc29uZ0R1cmF0aW9uOiBudW1iZXI7XG5cbiAgICBwcml2YXRlIHNvbmdMaXN0OiBBcnJheTxPYmplY3Q+ID0gW107XG5cbiAgICBwcml2YXRlIHVwZGF0ZUNhbGxiYWNrO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzY29yZVNlcnZpY2U6IFNjb3JlU2VydmljZSwgcHJpdmF0ZSByb3V0ZXJFeHRlbnNpb25zOiBSb3V0ZXJFeHRlbnNpb25zLCBwcml2YXRlIG11c2ljU2VydmljZTogTXVzaWNTZXJ2aWNlLCBwcml2YXRlIHpvbmU6IE5nWm9uZSwgcHJpdmF0ZSBwYWdlOiBQYWdlKSB7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2xlYXIgc29uZyBwaWNrZXIgYW5kIGluaXQgZ2VzdHVyZSAmIGF1ZGlvIHBsYXllci5cbiAgICAgKi9cbiAgICBwcml2YXRlIGxpc3RWaWV3SXRlbVRhcChhcmdzKSB7XG5cbiAgICAgICAgdGhpcy5xdWlja0dlc3R1cmVEZXRlY3Rpb24gPSBuZXcgUXVpY2tHZXN0dXJlRGV0ZWN0aW9uKHRoaXMpO1xuICAgICAgICB0aGlzLnBsYXllciA9IG5ldyBUTlNQbGF5ZXIoKTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZFNvbmcgPSB0aGlzLnNvbmdMaXN0W2FyZ3MuaW5kZXhdO1xuICAgICAgICB0aGlzLnBsYXlBdWRpbyh0aGlzLnNlbGVjdGVkU29uZ1sndXJsX211c2ljJ10pO1xuXG4gICAgICAgIHRoaXMuc2NvcmVzTGF5b3V0LnJlbW92ZUNoaWxkcmVuKCk7XG4gICAgICAgIHZhciBzY29yZUxhYmVsID0gdGhpcy5jcmVhdGVBYnNvbHV0ZUxhYmVsKFwiXCIsIDAsIDApO1xuICAgICAgICB2YXIgdGltZUxhYmVsID0gdGhpcy5jcmVhdGVBYnNvbHV0ZUxhYmVsKFwiXCIsIHNjcmVlbi5tYWluU2NyZWVuLndpZHRoRElQcyAtIDYwLCAwKTtcbiAgICAgICAgdGhpcy51cGRhdGVDYWxsYmFjayA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgIHNjb3JlTGFiZWwudGV4dCA9IFwiU2NvcmU6IFwiICsgdGhpcy5zY29yZTtcbiAgICAgICAgICAgIGlmICh0aGlzLnNvbmdEdXJhdGlvbiAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGltZUxhYmVsLnRleHQgPSAodGhpcy5zb25nRHVyYXRpb24gLSAoKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5zdGFydFRpbWUpIC8gMTAwMCkpLnRvRml4ZWQoMCkgKyBcInNcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgMTAwKTtcblxuICAgICAgICB0aGlzLnNjb3Jlc0xheW91dC5vbihcInRhcFwiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnF1aWNrR2VzdHVyZURldGVjdGVkKCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBvbkl0ZW1Mb2FkaW5nKGFyZ3M6IEl0ZW1FdmVudERhdGEpIHtcbiAgICAgICAgaWYgKGFyZ3MuaW9zKSB7XG4gICAgICAgICAgICAvLyBhcmdzLmlvcyBpcyBpbnN0YW5jZSBvZiBVSVRhYmxlVmlld0NlbGxcbiAgICAgICAgICAgIGFyZ3MuaW9zLnNlbGVjdGlvblN0eWxlID0gMDsgIC8vIFVJVGFibGVWaWV3Q2VsbFNlbGVjdGlvblN0eWxlLlVJVGFibGVWaWV3Q2VsbFNlbGVjdGlvblN0eWxlTm9uZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEluaXQgc29uZyBwaWNrZXIgYW5kIGZldGNoIHNvbmdzIGZyb20gYmFja2VuZC5cbiAgICAgKi9cbiAgICBwdWJsaWMgbmdPbkluaXQoKSB7XG4gICAgICAgIHRoaXMuc2NvcmVzTGF5b3V0ID0gPFN0YWNrTGF5b3V0PiB0aGlzLnBhZ2UuZ2V0Vmlld0J5SWQoXCJzY29yZXNMYXlvdXRcIik7XG4gICAgICAgIHRoaXMubXVzaWNTZXJ2aWNlLmdldERhdGEoKS5tYXAoanNvbiA9PiBqc29uLmNvbnRlbnQpLnN1YnNjcmliZShcbiAgICAgICAgICAgIChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNvbmdMaXN0ID0gcmVzdWx0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIChlcnJvcikgPT4gY29uc29sZS5sb2coZXJyb3IpXG4gICAgICAgICk7XG4gICAgfVxuXG4gICAgcHVibGljIHF1aWNrR2VzdHVyZURldGVjdGVkKCkge1xuICAgICAgICB2YXIgYWN0dWFsQmVhdEV4aXN0czogYm9vbGVhbiA9IGZhbHNlO1xuICAgICAgICB2YXIgdGltZVNpbmNlU3RhcnRJblNlY29uZHM6IG51bWJlciA9IChuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMuc3RhcnRUaW1lKSAvIDEwMDA7XG5cbiAgICAgICAgdmFyIGJlYXRzID0gdGhpcy5zZWxlY3RlZFNvbmdbJ2JlYXRzJ10uc3BsaXQoXCIsXCIpLm1hcChmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiArdmFsdWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZvciAobGV0IGJlYXQgb2YgYmVhdHMpIHtcbiAgICAgICAgICAgIC8vIGJlYXQgYXQgY3VycmVudCB0aW1lIGRldGVjdGVkXG4gICAgICAgICAgICB2YXIgZGlmZiA9IE1hdGguYWJzKGJlYXQgLSB0aW1lU2luY2VTdGFydEluU2Vjb25kcyk7XG4gICAgICAgICAgICBpZiAoZGlmZiA8IDAuMTIpIHtcbiAgICAgICAgICAgICAgICBhY3R1YWxCZWF0RXhpc3RzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoYWN0dWFsQmVhdEV4aXN0cykge1xuICAgICAgICAgICAgdGhpcy5zY29yZSArPSB0aGlzLnNjb3JlTXVsdGlwbGllcjtcbiAgICAgICAgICAgIHRoaXMuc2NvcmVNdWx0aXBsaWVyKys7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNjb3JlTXVsdGlwbGllciA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jcmVhdGVHZXN0dXJlRGV0ZWN0ZWRMYWJlbChhY3R1YWxCZWF0RXhpc3RzID8gXCIrXCIgKyB0aGlzLnNjb3JlTXVsdGlwbGllciA6IFwiTWlzc2VkIVwiLCBhY3R1YWxCZWF0RXhpc3RzLCAyNTAwLCAwLCB0aGlzLnNjb3JlTXVsdGlwbGllciAvIDEwKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNyZWF0ZUdlc3R1cmVEZXRlY3RlZExhYmVsKHRleHQ6IHN0cmluZywgY29ycmVjdERldGVjdGlvbjogYm9vbGVhbiA9IHRydWUsIGR1cmF0aW9uOiBudW1iZXIgPSAyNTAwLCBtaW5pbXVtT3BhY2l0eSA9IDAsIGV4cGFuZDogbnVtYmVyID0gMCkge1xuICAgICAgICB2YXIgbWluaW11bSA9IE1hdGgubWluKHNjcmVlbi5tYWluU2NyZWVuLndpZHRoRElQcywgc2NyZWVuLm1haW5TY3JlZW4uaGVpZ2h0RElQcyk7XG5cbiAgICAgICAgdmFyIGxhYmVsID0gbmV3IExhYmVsKCk7XG4gICAgICAgIGxhYmVsLnRleHRXcmFwID0gdHJ1ZTtcbiAgICAgICAgbGFiZWwuY3NzQ2xhc3MgPSBjb3JyZWN0RGV0ZWN0aW9uID8gXCJjb3JyZWN0LWRldGVjdGlvblwiIDogXCJmYWxzZS1kZXRlY3Rpb25cIjtcbiAgICAgICAgbGFiZWwudGV4dCA9IHRleHQ7XG4gICAgICAgIGxhYmVsLnN0eWxlLndpZHRoID0gbWluaW11bSAvIDIgKiAoMSArIGV4cGFuZCk7XG4gICAgICAgIGxhYmVsLnN0eWxlLmhlaWdodCA9IG1pbmltdW0gLyAyICogKDEgKyBleHBhbmQpO1xuICAgICAgICBsYWJlbC5zdHlsZS5ib3JkZXJSYWRpdXMgPSBtaW5pbXVtIC8gNCAqICgxICsgZXhwYW5kKTtcbiAgICAgICAgbGFiZWwuc3R5bGUuZm9udFNpemUgPSAzNSAqICgxICsgZXhwYW5kIC8gMik7XG5cbiAgICAgICAgQWJzb2x1dGVMYXlvdXQuc2V0TGVmdChsYWJlbCwgc2NyZWVuLm1haW5TY3JlZW4ud2lkdGhESVBzIC8gMiAtIChsYWJlbC5zdHlsZS53aWR0aCAvIDIpKTtcbiAgICAgICAgQWJzb2x1dGVMYXlvdXQuc2V0VG9wKGxhYmVsLCBzY3JlZW4ubWFpblNjcmVlbi5oZWlnaHRESVBzIC8gMiAtIChsYWJlbC5zdHlsZS5oZWlnaHQgLyAyKSk7XG4gICAgICAgIHRoaXMuc2NvcmVzTGF5b3V0LmFkZENoaWxkKGxhYmVsKTtcblxuICAgICAgICB2YXIgYW5pbWF0aW9uOiBBbmltYXRpb24gPSBsYWJlbC5jcmVhdGVBbmltYXRpb24oe1xuICAgICAgICAgICAgb3BhY2l0eTogbWluaW11bU9wYWNpdHksXG4gICAgICAgICAgICBkdXJhdGlvbjogZHVyYXRpb24sXG4gICAgICAgICAgICBjdXJ2ZTogQW5pbWF0aW9uQ3VydmUuZWFzZUluXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBhbmltYXRpb24ucGxheSgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY3JlYXRlQWJzb2x1dGVMYWJlbCh0ZXh0OiBzdHJpbmcsIGxlZnQ6IG51bWJlciwgdG9wOiBudW1iZXIpIHtcbiAgICAgICAgdmFyIGxhYmVsID0gbmV3IExhYmVsKCk7XG4gICAgICAgIGxhYmVsLnRleHRXcmFwID0gdHJ1ZTtcbiAgICAgICAgbGFiZWwuc3R5bGUuZm9udFNpemUgPSAyNDtcbiAgICAgICAgbGFiZWwuc3R5bGUudGV4dEFsaWdubWVudCA9ICdsZWZ0JztcbiAgICAgICAgbGFiZWwudGV4dCA9IHRleHQ7XG4gICAgICAgIGxhYmVsLnN0eWxlLnpJbmRleCA9IDEwMDA7XG5cbiAgICAgICAgQWJzb2x1dGVMYXlvdXQuc2V0TGVmdChsYWJlbCwgbGVmdCk7XG4gICAgICAgIEFic29sdXRlTGF5b3V0LnNldFRvcChsYWJlbCwgdG9wKTtcbiAgICAgICAgdGhpcy5zY29yZXNMYXlvdXQuYWRkQ2hpbGQobGFiZWwpO1xuICAgICAgICByZXR1cm4gbGFiZWw7XG4gICAgfVxuXG4gICAgcHVibGljIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLnBsYXllci5wYXVzZSgpO1xuICAgICAgICB0aGlzLnF1aWNrR2VzdHVyZURldGVjdGlvbi5kZXN0cm95KCk7XG4gICAgfVxuXG4gICAgcHVibGljIGdldE5nWm9uZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuem9uZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHBsYXlBdWRpbyhmaWxlcGF0aDogc3RyaW5nKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICB2YXIgcGxheWVyT3B0aW9uczogQXVkaW9QbGF5ZXJPcHRpb25zID0ge1xuICAgICAgICAgICAgICAgIGF1ZGlvRmlsZTogZmlsZXBhdGgsXG4gICAgICAgICAgICAgICAgbG9vcDogZmFsc2UsXG4gICAgICAgICAgICAgICAgY29tcGxldGVDYWxsYmFjazogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMudXBkYXRlQ2FsbGJhY2spO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjb3JlU2VydmljZS51cGRhdGVTY29yZShkZXZpY2UudXVpZCwgdGhpcy5zZWxlY3RlZFNvbmdbJ2lkJ10sIHRoaXMuc2NvcmUpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXllci5kaXNwb3NlKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnRElTUE9TRUQnKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0VSUk9SIGRpc3Bvc2VQbGF5ZXI6ICcgKyBlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yb3V0ZXJFeHRlbnNpb25zLm5hdmlnYXRlKFtcIlwiXSwge2NsZWFySGlzdG9yeTogdHJ1ZX0pO1xuICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICAgICBlcnJvckNhbGxiYWNrOiAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgICAgIGluZm9DYWxsYmFjazogKGluZm8pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ3aGF0OiBcIiArIGluZm8pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cblxuICAgICAgICAgICAgdGhpcy5wbGF5ZXIucGxheUZyb21VcmwocGxheWVyT3B0aW9ucykudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFydFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllci5nZXRBdWRpb1RyYWNrRHVyYXRpb24oKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zb25nRHVyYXRpb24gPSArcmVzdWx0O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgKGVycikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGV4KTtcbiAgICAgICAgfVxuICAgIH1cbn0iXX0=